/*
 * This file is the part of jsBeans, high-level JavaScript client-server framework.
 * The contents of this file are subject to the MIT Licence (MIT).
 * (c) aa@sis.ru, da@sis.ru, Special Information Systems, LLC, 2011-2019
 *
 * Настоящий файл является частью клиент-серверной JavaScript платформы.
 * Условия использования и распространения содержимого данного файла соответствуют программному обеспечению с открытыми исходными кодами и равнозначно MIT Licence (MIT).
 * Авторские права принадлежат aa@sis.ru, da@sis.ru, ООО СИС, 2011-2019гг.
 */

{
	$name:'JSB.Widgets.FileLoader',
	$parent: 'JSB.Widgets.Editor',
	$require: ['css:FileLoader.css'],
	$client: {
		
		_imgData: null,

		$constructor: function(opts){
			$base(opts);
			this.addClass('fileLoader');

			
			this.img = this.$('<img class="image" />');
			this.img.attr('src', 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0iTGF5ZXJfMSIKICAgeD0iMHB4IgogICB5PSIwcHgiCiAgIHZpZXdCb3g9IjAgMCAxMjggMTI4IgogICB4bWw6c3BhY2U9InByZXNlcnZlIgogICBzb2RpcG9kaTpkb2NuYW1lPSJuby1waG90by5zdmciCiAgIHdpZHRoPSIxMjgiCiAgIGhlaWdodD0iMTI4IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjAuMSAoM2JjMmU4MTNmNSwgMjAyMC0wOS0wNykiPjxtZXRhZGF0YQogICBpZD0ibWV0YWRhdGE2MyI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZQogICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPjxkYzp0aXRsZT48L2RjOnRpdGxlPjwvY2M6V29yaz48L3JkZjpSREY+PC9tZXRhZGF0YT48ZGVmcwogICBpZD0iZGVmczYxIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTEzOCIKICAgaWQ9Im5hbWVkdmlldzU5IgogICBzaG93Z3JpZD0iZmFsc2UiCiAgIGlua3NjYXBlOnpvb209IjIuODE2MTI1MiIKICAgaW5rc2NhcGU6Y3g9IjkuOTEwNzE4NyIKICAgaW5rc2NhcGU6Y3k9IjEwOC40ODk3IgogICBpbmtzY2FwZTp3aW5kb3cteD0iLTgiCiAgIGlua3NjYXBlOndpbmRvdy15PSItOCIKICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0iTGF5ZXJfMSIgLz4KCgoKCgoKCgo8cGF0aAogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Ik0gNjMuODc0ODQxLDAuMDAzIEMgMjguNTk3NzE2LDAuMDAzIDAsMjguNTk4MTQxIDAsNjMuODc3ODQxIGMgMCwzNS4yNzQyOTMgMjguNTk3NzE2LDYzLjg3MTc0OSA2My44NzQ4NDEsNjMuODcxNzQ5IDM1LjI3NTU4LDAgNjMuODczMjk5LC0yOC41OTc0NTYgNjMuODczMjk5LC02My44NzE3NDkgQyAxMjcuNzQ4MTQsMjguNTk3ODg0IDk5LjE1MDQyMSwwLjAwMyA2My44NzQ4NDEsMC4wMDMgWiIKICAgaWQ9InBhdGgyIiAvPjxwYXRoCiAgIHN0eWxlPSJmaWxsOiNmMmYyZjI7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgZD0ibSA2My44NzQ4NDEsMTAuMDQ0MjU2IGMgLTI5LjczMTM3NywwIC01My44MzMzMjcsMjQuMDk5NjMzIC01My44MzMzMjcsNTMuODMzMzI4IDAsMjkuNzI4ODAyIDI0LjEwMTk1LDUzLjgzMDc1NiA1My44MzMzMjcsNTMuODMwNzU2IDI5LjcyOTgzMiwwIDUzLjgzMTc3OSwtMjQuMTAxOTU0IDUzLjgzMTc3OSwtNTMuODMwNzU2IDAsLTI5LjczMzY5NSAtMjQuMTAxOTQ3LC01My44MzMzMjggLTUzLjgzMTc3OSwtNTMuODMzMzI4IHoiCiAgIGlkPSJwYXRoNCIgLz48ZwogICBpZD0iZzEwIgogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIHRyYW5zZm9ybT0ibWF0cml4KDAuMjU3NDc0NzEsMCwwLDAuMjU3NDc0NzEsMCwwLjAwMjIyNzU4KSI+Cgk8cGF0aAogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gMTQ1LjIzLDE0NC4yMzcgaCAtMjQuNDQgYyAtMy4yMSwwIC01LjgxOSw0Ljc0MSAtNS44MTksMTAuNjA1IDAsNS44NjQgMi42MDksMTAuNjExIDUuODE5LDEwLjYxMSBoIDI0LjQ0IGMgMy4yMTcsMCA1LjgyNiwtNC43NDcgNS44MjYsLTEwLjYxMSAxMGUtNCwtNS44NjQgLTIuNjA5LC0xMC42MDUgLTUuODI2LC0xMC42MDUgeiIKICAgaWQ9InBhdGg2IiAvPgoJPHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6Ny43Njc3NTtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJNIDM4MC4yODksMTcyLjA2IEggMjI2LjU0NSBjIC0yLjAyNSwtOS44NTEgLTkuNDE2LC0xNy4xNzYgLTE4LjI0NCwtMTcuMTc2IGggLTkyLjE5OSBjIC0xMC40MDMsMCAtMTguODE4LDEwLjEyNSAtMTguODE4LDIyLjU5MiBWIDMyOC45IGMgMCwxMC4yNTQgOC4zMTQsMTguNTgxIDE4LjU4LDE4LjU4MSBoIDI2NC40MjUgYyAxMC4yNjIsMCAxOC41ODYsLTguMzI3IDE4LjU4NiwtMTguNTgxIFYgMTkwLjY1NSBjIDAsLTEwLjI3NSAtOC4zMjQsLTE4LjU5NSAtMTguNTg2LC0xOC41OTUgeiIKICAgaWQ9InBhdGg4IiAvPgo8L2c+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2Y0ZWRlZDtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDYzLjg3MzI5Niw0Mi45MjYwOTQgYyAtMTMuMTY1NDU0LDAgLTIzLjg0MzE4OCwxMC42NzU0MTYgLTIzLjg0MzE4OCwyMy44NDI2NzMgMCwxMy4xNjg4MDIgMTAuNjc3NzM0LDIzLjg0NDIxOCAyMy44NDMxODgsMjMuODQ0MjE4IDEzLjE2Njk5OSwwIDIzLjg0MjE1OCwtMTAuNjc1NDE2IDIzLjg0MjE1OCwtMjMuODQ0MjE4IDAsLTEzLjE2Njk5OSAtMTAuNjc1MTU5LC0yMy44NDI2NzMgLTIzLjg0MjE1OCwtMjMuODQyNjczIHoiCiAgIGlkPSJwYXRoMTIiIC8+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDYzLjg3NTg3MSw0NC4xMzc1MTIgYyAtMTIuNDk5NjI1LDAgLTIyLjYzNDM0NCwxMC4xMzI5MTggLTIyLjYzNDM0NCwyMi42MzQzNDUgMCwxMi40OTcwNSAxMC4xMzQ3MTksMjIuNjMxNTEyIDIyLjYzNDM0NCwyMi42MzE1MTIgMTIuNDk4NTk1LDAgMjIuNjMwOTk3LC0xMC4xMzQ0NjIgMjIuNjMwOTk3LC0yMi42MzE1MTIgQyA4Ni41MDY2MTEsNTQuMjcwNDMgNzYuMzc0NDY2LDQ0LjEzNzUxMiA2My44NzU4NzEsNDQuMTM3NTEyIFoiCiAgIGlkPSJwYXRoMTQiIC8+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2Y0ZWRlZDtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDY0LjAxMTA0NSw1Mi43ODU4MzEgYyAtNy43MjIxODEsMCAtMTMuOTgzOTY2LDYuMjU5MjEgLTEzLjk4Mzk2NiwxMy45ODI5MzYgMCw3LjcyMTkyNCA2LjI2MTUyNywxMy45ODYyODQgMTMuOTgzOTY2LDEzLjk4NjI4NCA3LjcyMjQzOSwwIDEzLjk4NTUxMSwtNi4yNjQzNiAxMy45ODU1MTEsLTEzLjk4NjI4NCAyLjU4ZS00LC03LjcyMzcyNiAtNi4yNjMzMjksLTEzLjk4MjkzNiAtMTMuOTg1NTExLC0xMy45ODI5MzYgeiIKICAgaWQ9InBhdGgxNiIgLz48cGF0aAogICBzdHlsZT0iZmlsbDojOTk5OTk5O3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gNjQuMDExMDQ1LDUzLjk1MDM4OSBjIC03LjA3OTAxLDAgLTEyLjgxOTQwOCw1LjczODA4MSAtMTIuODE5NDA4LDEyLjgxODYzNiAwLDcuMDc5MDA5IDUuNzQwMzk4LDEyLjgyMTcyNSAxMi44MTk0MDgsMTIuODIxNzI1IDcuMDc5NTI1LDAgMTIuODIwOTUzLC01Ljc0MjcxNiAxMi44MjA5NTMsLTEyLjgyMTcyNSAwLC03LjA4MDU1NSAtNS43NDE0MjgsLTEyLjgxODYzNiAtMTIuODIwOTUzLC0xMi44MTg2MzYgeiIKICAgaWQ9InBhdGgxOCIgLz48ZwogICBpZD0iZzI0IgogICBzdHlsZT0ic3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjcuNzY3NzU7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgdHJhbnNmb3JtPSJtYXRyaXgoMC4yNTc0NzQ3MSwwLDAsMC4yNTc0NzQ3MSwwLDAuMDAyMjI3NTgpIj4KCTxwYXRoCiAgIHN0eWxlPSJmaWxsOiNmNGVkZWQ7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjcuNzY3NzU7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgZD0ibSAyMzAuMjI0LDIxNS4wMDIgYyAtMTQuNDAxLDAgLTI2LjA2NSwxMS42NzQgLTI2LjA2NSwyNi4wNjcgMCwxNC4zOTkgMTEuNjY0LDI2LjA3MyAyNi4wNjUsMjYuMDczIDE0LjM5MSwwIDI2LjA2NSwtMTEuNjc0IDI2LjA2NSwtMjYuMDczIDAsLTE0LjM5MyAtMTEuNjc1LC0yNi4wNjcgLTI2LjA2NSwtMjYuMDY3IHoiCiAgIGlkPSJwYXRoMjAiIC8+Cgk8cGF0aAogICBzdHlsZT0iZmlsbDojZjRlZGVkO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gMTU5LjY5OCwxNjUuNDUzIGggLTQ1LjcxMiBjIC0zLjc1NiwwIC02LjgwNSwzLjA0NSAtNi44MDUsNi43OTIgdiAyNS41OTQgYyAwLDMuMDQgMi4wMDQsNS41NzUgNC43NTYsNi40NDggMC42NSwwLjIwOSAxLjMyOCwwLjM1IDIuMDQ5LDAuMzUgaCA0NS43MTIgYyAzLjc2LDAgNi43OTMsLTMuMDQgNi43OTMsLTYuNzk4IHYgLTI1LjU5NCBjIDAsLTMuNzQ3IC0zLjAzMywtNi43OTIgLTYuNzkzLC02Ljc5MiB6IgogICBpZD0icGF0aDIyIiAvPgo8L2c+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDIyLjEwNDIwNCwxNS41NTIxNTUgYyAtMi4zMzk0MTUsMi4wMjM3NTEgLTQuNTMwNTI1LDQuMjE0ODYxIC02LjU1NDI3Niw2LjU1NDI3NiBsIDkwLjA5NDAwMiw5MC4wOTQwMDkgYyAyLjMzOTQyLC0yLjAyNDAxIDQuNTMwNTMsLTQuMjE0ODYgNi41NTQyOCwtNi41NTQyOCB6IgogICBpZD0icGF0aDI2IiAvPgo8ZwogICBpZD0iZzI4Ij4KPC9nPgo8ZwogICBpZD0iZzMwIj4KPC9nPgo8ZwogICBpZD0iZzMyIj4KPC9nPgo8ZwogICBpZD0iZzM0Ij4KPC9nPgo8ZwogICBpZD0iZzM2Ij4KPC9nPgo8ZwogICBpZD0iZzM4Ij4KPC9nPgo8ZwogICBpZD0iZzQwIj4KPC9nPgo8ZwogICBpZD0iZzQyIj4KPC9nPgo8ZwogICBpZD0iZzQ0Ij4KPC9nPgo8ZwogICBpZD0iZzQ2Ij4KPC9nPgo8ZwogICBpZD0iZzQ4Ij4KPC9nPgo8ZwogICBpZD0iZzUwIj4KPC9nPgo8ZwogICBpZD0iZzUyIj4KPC9nPgo8ZwogICBpZD0iZzU0Ij4KPC9nPgo8ZwogICBpZD0iZzU2Ij4KPC9nPgo8L3N2Zz4K');
			this.append(this.img);
			this.input = this.$('<input type="file" multiple style="display: none;" />');
			this.append(this.input);
			this.clearBtn = this.$('<div class="clearBtn"></div>');
			this.append(this.clearBtn);
			this.clear();
			
			if(this.options.width){
				this.img.css('width', this.options.width);
			}
			if(this.options.height){
				this.img.css('height', this.options.height);
			}
			if(this.options.size){
				this.img.css('max-width', this.options.size);
				this.img.css('max-height', this.options.size);
			}
			
			if(this.options.value){
			    this.setData(this.options.value);
			}

			this.clearBtn.click(function(evt){
				$this.clear();
				if($this.options.onChange){
					$this.options.onChange.call($this, '');
				}
				evt.stopPropagation();
			});

			this.getElement().click(function(evt){
				if($this.isReadonly()){
					return;
				}
				if(evt.target == $this.input.get(0)){
					return;
				}
				$this.input.trigger('click');
			});
			
			this.input.change(function(){
				if(!this.files || this.files.length == 0){
					return;
				}
				$this._loadFromFile(this.files[0]);
			});
		},

		options: {
		    readonly: false,
			onChange: null
		},
		
		_loadFromFile: function(file){
			var prefixes = {
				'image/png': true,
				'image/svg+xml': true,
				'image/jpeg': true,
				'image/gif': true
			};
			var name = file.name;
			var size = file.size;
			var type = file.type;
			if(!prefixes[type]){
				return;
			}
			
			var reader = new FileReader();
			reader.onload = function(){
				var content = reader.result;
				var base64Data = JSB().Base64.encode(content);
				var imageStr = 'data:' + type + ';base64,' + base64Data;
				$this.setData(imageStr);
				if($this.options.onChange){
					$this.options.onChange.call($this, imageStr);
				}
			}
			reader.readAsArrayBuffer(file);
		},
		
		clear: function(){
			this.addClass('empty');
			this._imgData = null;
			$this.img.attr('src', 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0iTGF5ZXJfMSIKICAgeD0iMHB4IgogICB5PSIwcHgiCiAgIHZpZXdCb3g9IjAgMCAxMjggMTI4IgogICB4bWw6c3BhY2U9InByZXNlcnZlIgogICBzb2RpcG9kaTpkb2NuYW1lPSJuby1waG90by5zdmciCiAgIHdpZHRoPSIxMjgiCiAgIGhlaWdodD0iMTI4IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjAuMSAoM2JjMmU4MTNmNSwgMjAyMC0wOS0wNykiPjxtZXRhZGF0YQogICBpZD0ibWV0YWRhdGE2MyI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZQogICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPjxkYzp0aXRsZT48L2RjOnRpdGxlPjwvY2M6V29yaz48L3JkZjpSREY+PC9tZXRhZGF0YT48ZGVmcwogICBpZD0iZGVmczYxIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTEzOCIKICAgaWQ9Im5hbWVkdmlldzU5IgogICBzaG93Z3JpZD0iZmFsc2UiCiAgIGlua3NjYXBlOnpvb209IjIuODE2MTI1MiIKICAgaW5rc2NhcGU6Y3g9IjkuOTEwNzE4NyIKICAgaW5rc2NhcGU6Y3k9IjEwOC40ODk3IgogICBpbmtzY2FwZTp3aW5kb3cteD0iLTgiCiAgIGlua3NjYXBlOndpbmRvdy15PSItOCIKICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0iTGF5ZXJfMSIgLz4KCgoKCgoKCgo8cGF0aAogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Ik0gNjMuODc0ODQxLDAuMDAzIEMgMjguNTk3NzE2LDAuMDAzIDAsMjguNTk4MTQxIDAsNjMuODc3ODQxIGMgMCwzNS4yNzQyOTMgMjguNTk3NzE2LDYzLjg3MTc0OSA2My44NzQ4NDEsNjMuODcxNzQ5IDM1LjI3NTU4LDAgNjMuODczMjk5LC0yOC41OTc0NTYgNjMuODczMjk5LC02My44NzE3NDkgQyAxMjcuNzQ4MTQsMjguNTk3ODg0IDk5LjE1MDQyMSwwLjAwMyA2My44NzQ4NDEsMC4wMDMgWiIKICAgaWQ9InBhdGgyIiAvPjxwYXRoCiAgIHN0eWxlPSJmaWxsOiNmMmYyZjI7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgZD0ibSA2My44NzQ4NDEsMTAuMDQ0MjU2IGMgLTI5LjczMTM3NywwIC01My44MzMzMjcsMjQuMDk5NjMzIC01My44MzMzMjcsNTMuODMzMzI4IDAsMjkuNzI4ODAyIDI0LjEwMTk1LDUzLjgzMDc1NiA1My44MzMzMjcsNTMuODMwNzU2IDI5LjcyOTgzMiwwIDUzLjgzMTc3OSwtMjQuMTAxOTU0IDUzLjgzMTc3OSwtNTMuODMwNzU2IDAsLTI5LjczMzY5NSAtMjQuMTAxOTQ3LC01My44MzMzMjggLTUzLjgzMTc3OSwtNTMuODMzMzI4IHoiCiAgIGlkPSJwYXRoNCIgLz48ZwogICBpZD0iZzEwIgogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIHRyYW5zZm9ybT0ibWF0cml4KDAuMjU3NDc0NzEsMCwwLDAuMjU3NDc0NzEsMCwwLjAwMjIyNzU4KSI+Cgk8cGF0aAogICBzdHlsZT0iZmlsbDojYjNiM2IzO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gMTQ1LjIzLDE0NC4yMzcgaCAtMjQuNDQgYyAtMy4yMSwwIC01LjgxOSw0Ljc0MSAtNS44MTksMTAuNjA1IDAsNS44NjQgMi42MDksMTAuNjExIDUuODE5LDEwLjYxMSBoIDI0LjQ0IGMgMy4yMTcsMCA1LjgyNiwtNC43NDcgNS44MjYsLTEwLjYxMSAxMGUtNCwtNS44NjQgLTIuNjA5LC0xMC42MDUgLTUuODI2LC0xMC42MDUgeiIKICAgaWQ9InBhdGg2IiAvPgoJPHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6Ny43Njc3NTtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJNIDM4MC4yODksMTcyLjA2IEggMjI2LjU0NSBjIC0yLjAyNSwtOS44NTEgLTkuNDE2LC0xNy4xNzYgLTE4LjI0NCwtMTcuMTc2IGggLTkyLjE5OSBjIC0xMC40MDMsMCAtMTguODE4LDEwLjEyNSAtMTguODE4LDIyLjU5MiBWIDMyOC45IGMgMCwxMC4yNTQgOC4zMTQsMTguNTgxIDE4LjU4LDE4LjU4MSBoIDI2NC40MjUgYyAxMC4yNjIsMCAxOC41ODYsLTguMzI3IDE4LjU4NiwtMTguNTgxIFYgMTkwLjY1NSBjIDAsLTEwLjI3NSAtOC4zMjQsLTE4LjU5NSAtMTguNTg2LC0xOC41OTUgeiIKICAgaWQ9InBhdGg4IiAvPgo8L2c+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2Y0ZWRlZDtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDYzLjg3MzI5Niw0Mi45MjYwOTQgYyAtMTMuMTY1NDU0LDAgLTIzLjg0MzE4OCwxMC42NzU0MTYgLTIzLjg0MzE4OCwyMy44NDI2NzMgMCwxMy4xNjg4MDIgMTAuNjc3NzM0LDIzLjg0NDIxOCAyMy44NDMxODgsMjMuODQ0MjE4IDEzLjE2Njk5OSwwIDIzLjg0MjE1OCwtMTAuNjc1NDE2IDIzLjg0MjE1OCwtMjMuODQ0MjE4IDAsLTEzLjE2Njk5OSAtMTAuNjc1MTU5LC0yMy44NDI2NzMgLTIzLjg0MjE1OCwtMjMuODQyNjczIHoiCiAgIGlkPSJwYXRoMTIiIC8+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDYzLjg3NTg3MSw0NC4xMzc1MTIgYyAtMTIuNDk5NjI1LDAgLTIyLjYzNDM0NCwxMC4xMzI5MTggLTIyLjYzNDM0NCwyMi42MzQzNDUgMCwxMi40OTcwNSAxMC4xMzQ3MTksMjIuNjMxNTEyIDIyLjYzNDM0NCwyMi42MzE1MTIgMTIuNDk4NTk1LDAgMjIuNjMwOTk3LC0xMC4xMzQ0NjIgMjIuNjMwOTk3LC0yMi42MzE1MTIgQyA4Ni41MDY2MTEsNTQuMjcwNDMgNzYuMzc0NDY2LDQ0LjEzNzUxMiA2My44NzU4NzEsNDQuMTM3NTEyIFoiCiAgIGlkPSJwYXRoMTQiIC8+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2Y0ZWRlZDtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDY0LjAxMTA0NSw1Mi43ODU4MzEgYyAtNy43MjIxODEsMCAtMTMuOTgzOTY2LDYuMjU5MjEgLTEzLjk4Mzk2NiwxMy45ODI5MzYgMCw3LjcyMTkyNCA2LjI2MTUyNywxMy45ODYyODQgMTMuOTgzOTY2LDEzLjk4NjI4NCA3LjcyMjQzOSwwIDEzLjk4NTUxMSwtNi4yNjQzNiAxMy45ODU1MTEsLTEzLjk4NjI4NCAyLjU4ZS00LC03LjcyMzcyNiAtNi4yNjMzMjksLTEzLjk4MjkzNiAtMTMuOTg1NTExLC0xMy45ODI5MzYgeiIKICAgaWQ9InBhdGgxNiIgLz48cGF0aAogICBzdHlsZT0iZmlsbDojOTk5OTk5O3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gNjQuMDExMDQ1LDUzLjk1MDM4OSBjIC03LjA3OTAxLDAgLTEyLjgxOTQwOCw1LjczODA4MSAtMTIuODE5NDA4LDEyLjgxODYzNiAwLDcuMDc5MDA5IDUuNzQwMzk4LDEyLjgyMTcyNSAxMi44MTk0MDgsMTIuODIxNzI1IDcuMDc5NTI1LDAgMTIuODIwOTUzLC01Ljc0MjcxNiAxMi44MjA5NTMsLTEyLjgyMTcyNSAwLC03LjA4MDU1NSAtNS43NDE0MjgsLTEyLjgxODYzNiAtMTIuODIwOTUzLC0xMi44MTg2MzYgeiIKICAgaWQ9InBhdGgxOCIgLz48ZwogICBpZD0iZzI0IgogICBzdHlsZT0ic3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjcuNzY3NzU7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgdHJhbnNmb3JtPSJtYXRyaXgoMC4yNTc0NzQ3MSwwLDAsMC4yNTc0NzQ3MSwwLDAuMDAyMjI3NTgpIj4KCTxwYXRoCiAgIHN0eWxlPSJmaWxsOiNmNGVkZWQ7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjcuNzY3NzU7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgZD0ibSAyMzAuMjI0LDIxNS4wMDIgYyAtMTQuNDAxLDAgLTI2LjA2NSwxMS42NzQgLTI2LjA2NSwyNi4wNjcgMCwxNC4zOTkgMTEuNjY0LDI2LjA3MyAyNi4wNjUsMjYuMDczIDE0LjM5MSwwIDI2LjA2NSwtMTEuNjc0IDI2LjA2NSwtMjYuMDczIDAsLTE0LjM5MyAtMTEuNjc1LC0yNi4wNjcgLTI2LjA2NSwtMjYuMDY3IHoiCiAgIGlkPSJwYXRoMjAiIC8+Cgk8cGF0aAogICBzdHlsZT0iZmlsbDojZjRlZGVkO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDo3Ljc2Nzc1O3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiCiAgIGQ9Im0gMTU5LjY5OCwxNjUuNDUzIGggLTQ1LjcxMiBjIC0zLjc1NiwwIC02LjgwNSwzLjA0NSAtNi44MDUsNi43OTIgdiAyNS41OTQgYyAwLDMuMDQgMi4wMDQsNS41NzUgNC43NTYsNi40NDggMC42NSwwLjIwOSAxLjMyOCwwLjM1IDIuMDQ5LDAuMzUgaCA0NS43MTIgYyAzLjc2LDAgNi43OTMsLTMuMDQgNi43OTMsLTYuNzk4IHYgLTI1LjU5NCBjIDAsLTMuNzQ3IC0zLjAzMywtNi43OTIgLTYuNzkzLC02Ljc5MiB6IgogICBpZD0icGF0aDIyIiAvPgo8L2c+PHBhdGgKICAgc3R5bGU9ImZpbGw6I2IzYjNiMztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIgogICBkPSJtIDIyLjEwNDIwNCwxNS41NTIxNTUgYyAtMi4zMzk0MTUsMi4wMjM3NTEgLTQuNTMwNTI1LDQuMjE0ODYxIC02LjU1NDI3Niw2LjU1NDI3NiBsIDkwLjA5NDAwMiw5MC4wOTQwMDkgYyAyLjMzOTQyLC0yLjAyNDAxIDQuNTMwNTMsLTQuMjE0ODYgNi41NTQyOCwtNi41NTQyOCB6IgogICBpZD0icGF0aDI2IiAvPgo8ZwogICBpZD0iZzI4Ij4KPC9nPgo8ZwogICBpZD0iZzMwIj4KPC9nPgo8ZwogICBpZD0iZzMyIj4KPC9nPgo8ZwogICBpZD0iZzM0Ij4KPC9nPgo8ZwogICBpZD0iZzM2Ij4KPC9nPgo8ZwogICBpZD0iZzM4Ij4KPC9nPgo8ZwogICBpZD0iZzQwIj4KPC9nPgo8ZwogICBpZD0iZzQyIj4KPC9nPgo8ZwogICBpZD0iZzQ0Ij4KPC9nPgo8ZwogICBpZD0iZzQ2Ij4KPC9nPgo8ZwogICBpZD0iZzQ4Ij4KPC9nPgo8ZwogICBpZD0iZzUwIj4KPC9nPgo8ZwogICBpZD0iZzUyIj4KPC9nPgo8ZwogICBpZD0iZzU0Ij4KPC9nPgo8ZwogICBpZD0iZzU2Ij4KPC9nPgo8L3N2Zz4K');
		},

		setData: function(val){
			if(val){
				this._imgData = val;
				$this.img.attr('src', this._imgData);
				$this.removeClass('empty');
			} else {
				this.clear();
			}
		},

		setReadonly: function(b){
			this.options.readonly = b;
		},

		isReadonly: function(){
			return this.options.readonly;
		},

		getData: function(){
			return this._imgData;
		},


		// events
		_onChange: function(color){
		    this._color = color;

		    if(this.options.onChange){
                this.options.onChange.call(this, color);
            }
		}
	}
}