{
	$name: 'DataCube.DashboardPublicationView',
	$parent: 'JSB.Workspace.BrowserView',
	
	$client: {
		ready: false,
		ignoreHandlers: false,
		
		$constructor: function(opts){
			$base(opts);
			
			this.loadCss('DashboardPublicationView.css');
			this.addClass('dashboardPublicationView');
			
			this.append(`#dot
				<div jsb="JSB.Widgets.ScrollBox" class="scroll">
			
					<div jsb="JSB.Widgets.GroupBox" caption="Идентификация визуализации" collapsible="false" class="dashboardSettings">
						<div class="option workspaceId">
							<div class="icon"></div>
							<div class="editor" jsb="JSB.Widgets.PrimitiveEditor" readonly="true" title="Идентификатор рабочей области" placeholder="Идентификатор рабочей области"></div>
						</div>
						
						<div class="option dashboardId">
							<div class="icon"></div>
							<div class="editor" jsb="JSB.Widgets.PrimitiveEditor" readonly="true" title="Идентификатор визуализации" placeholder="Идентификатор визуализации"></div>
						</div>
						
						<div class="option dashboardShare">
							<div class="icon"></div>
							<div class="editor" jsb="JSB.Widgets.PrimitiveEditor" readonly="true" title="URL визуализации" placeholder="URL визуализации"></div>
							<div jsb="JSB.Widgets.Button" class="roundButton btn16 btnOpenNewWindow" caption="Открыть"
								onclick="{{=this.callbackAttr(function(evt){$this.openNewWindow()})}}"></div>
							
						</div>
					</div>
					
				</div>
			`);
		},
		
		refresh: function(){
			if(!this.ready){
				JSB.deferUntil(function(){
					$this.ready = true;
					$this.refresh();
				}, function(){
					return $this.isContentReady();
				});
				return;
			}

			$this.fillSettings();
		},
		
		fillSettings: function(){
			var entry = this.node.getEntry();
			$this.ignoreHandlers = true;
			var wid = entry.getWorkspace().getId();
			var eid = entry.getId();
			
			// fill id
			this.find('.workspaceId > .editor').jsb().setData(wid);
			this.find('.dashboardId > .editor').jsb().setData(eid);
			
			var jsbPath = JSB.getProvider().getServerBase() + 'datacube/Dashboard.jsb?wsid=' + wid + '&did=' + eid;
			this.find('.dashboardShare > .editor').jsb().setData(jsbPath);
			
			$this.ignoreHandlers = false;
		},
		
		openNewWindow: function(){
			var url = this.find('.dashboardShare > .editor').jsb().getData().getValue();
			var win = window.open(url, '_blank');
			win.focus();
		}
		
	},
	
	$server: {
		$require: 'JSB.Workspace.WorkspaceController',
		$bootstrap: function(){
			WorkspaceController.registerBrowserView(null, this, {
				priority: 0.3,
				acceptNode: 'DataCube.DashboardNode',
				caption: 'Публикация',
				icon: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8IS0tIFN2ZyBWZWN0b3IgSWNvbnMgOiBodHRwOi8vd3d3Lm9ubGluZXdlYmZvbnRzLmNvbS9pY29uIC0tPg0KDQo8c3ZnDQogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iDQogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIg0KICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIg0KICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyINCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCINCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIg0KICAgdmVyc2lvbj0iMS4xIg0KICAgeD0iMHB4Ig0KICAgeT0iMHB4Ig0KICAgdmlld0JveD0iMCAwIDIwIDIwIg0KICAgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwMCAxMDAwIg0KICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSINCiAgIGlkPSJzdmcyIg0KICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45MSByMTM3MjUiDQogICBzb2RpcG9kaTpkb2NuYW1lPSJkYXNoYm9hcmRfdmlldy5zdmciDQogICB3aWR0aD0iMjAiDQogICBoZWlnaHQ9IjIwIj48ZGVmcw0KICAgICBpZD0iZGVmczEyIj48bGluZWFyR3JhZGllbnQNCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQzMDQ5Ij48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6Izg4OGE4NTtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjAiDQogICAgICAgICBpZD0ic3RvcDMwNTEiIC8+PHN0b3ANCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNkM2Q3Y2Y7c3RvcC1vcGFjaXR5OjE7Ig0KICAgICAgICAgb2Zmc2V0PSIwLjUiDQogICAgICAgICBpZD0ic3RvcDIyNjIiIC8+PHN0b3ANCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNlZWVlZWM7c3RvcC1vcGFjaXR5OjE7Ig0KICAgICAgICAgb2Zmc2V0PSIwLjY3NjEyOTU4Ig0KICAgICAgICAgaWQ9InN0b3AyMjY0IiAvPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojYmFiZGI2O3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMC44NDA1MTcyMiINCiAgICAgICAgIGlkPSJzdG9wMjI2OCIgLz48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2QzZDdjZjtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjAuODc1Ig0KICAgICAgICAgaWQ9InN0b3AyMjY2IiAvPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojYmFiZGI2O3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMSINCiAgICAgICAgIGlkPSJzdG9wMzA1MyIgLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudA0KICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDMwNjEiPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMCINCiAgICAgICAgIGlkPSJzdG9wMzA2MyIgLz48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMDAwMDtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjEiDQogICAgICAgICBpZD0ic3RvcDMwNjUiIC8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQNCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQzMDc3Ij48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6Izg4OGE4NTtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjAiDQogICAgICAgICBpZD0ic3RvcDMwNzkiIC8+PHN0b3ANCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNkM2Q3Y2Y7c3RvcC1vcGFjaXR5OjE7Ig0KICAgICAgICAgb2Zmc2V0PSIxIg0KICAgICAgICAgaWQ9InN0b3AzMDgxIiAvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50DQogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50MzA4NyI+PHN0b3ANCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiMzNDY1YTQ7c3RvcC1vcGFjaXR5OjE7Ig0KICAgICAgICAgb2Zmc2V0PSIwIg0KICAgICAgICAgaWQ9InN0b3AzMDg5IiAvPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojOWZiY2UxO3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMCINCiAgICAgICAgIGlkPSJzdG9wMzA5NSIgLz48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzZiOTVjYTtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjAiDQogICAgICAgICBpZD0ic3RvcDIyNDIiIC8+PHN0b3ANCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiMzZDZhYTU7c3RvcC1vcGFjaXR5OjE7Ig0KICAgICAgICAgb2Zmc2V0PSIwLjc1Ig0KICAgICAgICAgaWQ9InN0b3AyMjQ0IiAvPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMzg2ZWI0O3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMSINCiAgICAgICAgIGlkPSJzdG9wMzA5MSIgLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudA0KICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDMzMjciPjxzdG9wDQogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMDBhMWZmO3N0b3Atb3BhY2l0eToxOyINCiAgICAgICAgIG9mZnNldD0iMCINCiAgICAgICAgIGlkPSJzdG9wMzMyOSIgLz48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMDAwMTtzdG9wLW9wYWNpdHk6MTsiDQogICAgICAgICBvZmZzZXQ9IjEiDQogICAgICAgICBpZD0ic3RvcDMzMzEiIC8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQNCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQzMjQ0Ij48c3RvcA0KICAgICAgICAgaWQ9InN0b3AzMjQ2Ig0KICAgICAgICAgb2Zmc2V0PSIwIg0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2NlZjhjZTtzdG9wLW9wYWNpdHk6MSIgLz48c3RvcA0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwOGU4NDtzdG9wLW9wYWNpdHk6MSINCiAgICAgICAgIG9mZnNldD0iMC40NDI1MTg4MyINCiAgICAgICAgIGlkPSJzdG9wNDAyMiIgLz48c3RvcA0KICAgICAgICAgaWQ9InN0b3AzMjQ4Ig0KICAgICAgICAgb2Zmc2V0PSIxIg0KICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMDAwMTtzdG9wLW9wYWNpdHk6MTsiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHNvZGlwb2RpOm5hbWVkdmlldw0KICAgICBwYWdlY29sb3I9IiNmZmZmZmYiDQogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2Ig0KICAgICBib3JkZXJvcGFjaXR5PSIxIg0KICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIg0KICAgICBncmlkdG9sZXJhbmNlPSIxMCINCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIg0KICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCINCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiINCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxOTIwIg0KICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMTM4Ig0KICAgICBpZD0ibmFtZWR2aWV3MTAiDQogICAgIHNob3dncmlkPSJmYWxzZSINCiAgICAgaW5rc2NhcGU6em9vbT0iMzIiDQogICAgIGlua3NjYXBlOmN4PSI4LjI4OTUxNzYiDQogICAgIGlua3NjYXBlOmN5PSI4LjIxNDQ0MDMiDQogICAgIGlua3NjYXBlOndpbmRvdy14PSItOCINCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04Ig0KICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIg0KICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmcyIg0KICAgICBzaG93Z3VpZGVzPSJ0cnVlIg0KICAgICBpbmtzY2FwZTpndWlkZS1iYm94PSJ0cnVlIiAvPjxtZXRhZGF0YQ0KICAgICBpZD0ibWV0YWRhdGE0Ij4gU3ZnIFZlY3RvciBJY29ucyA6IGh0dHA6Ly93d3cub25saW5ld2ViZm9udHMuY29tL2ljb24gPHJkZjpSREY+PGNjOldvcmsNCiAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlDQogICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGUgLz48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGcNCiAgICAgaWQ9Imc0MTg5Ig0KICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjQwNTMxNjQsMCwwLDEuNDA1MzE2NCwtNC4wNDc3NDk2LC0zLjAyOTczKSI+PHBhdGgNCiAgICAgICBzdHlsZT0iZmlsbDojMDA2NjgwO2ZpbGwtb3BhY2l0eToxIg0KICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiDQogICAgICAgaWQ9InBhdGg2Ig0KICAgICAgIGQ9Ik0gNi43NzA2OTAyLDkuMDg2ODQ4IEMgNi43NzA2OTAyLDcuODAzODExIDcuNTIzMzExLDYuNjk5NSA4LjYxMDY0Niw2LjE4MzQ3NSA1LjE1MzUzLDYuODEwMzIyIDIuODkzNDE4Miw5LjM1MDQ4MSAyLjg5MzQxODIsOS4zNTA0ODEgNS4wNDk2NTA0LDExLjEzMTQxNSA3LjA4Njc0MTYsMTEuOTEzNjYgOC45MDg1NDEsMTIuMTE0MjUyIDcuNjYzNTA0LDExLjY3MDQ1OSA2Ljc3MDcxODMsMTAuNDg0NDE2IDYuNzcwNzE4Myw5LjA4Njg0OCBaIiAvPjxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzAwNjY4MDtmaWxsLW9wYWNpdHk6MSINCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgIGlkPSJwYXRoOC04Ig0KICAgICAgIGQ9Ik0gMTcuMDc5ODY4LDkuMDk0MzI0IEMgMTQuOTk1NTg3LDcuMjM1OTU4IDEzLjAwODAxOSw2LjM5OTg5MSAxMS4yMTQxLDYuMTY5MDg1IGMgMS4xNjc2MDYsMC40ODIzNTQgMS45ODg0NCwxLjYyOTgzNiAxLjk4ODQ0LDIuOTcxNTg1IDAsMS4zNTc4ODMgLTAuODQzMjYzLDIuNTE1NzA4IC0yLjAzMjQ4MiwyLjk4ODU2MiAzLjU4ODkzMywtMC41MTk0ODIgNS45MDk3ODIsLTMuMDM0OTA4IDUuOTA5NzgyLC0zLjAzNDkwOCB6IiAvPjxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzEwOTdmYztmaWxsLW9wYWNpdHk6MSINCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgIGlkPSJwYXRoMTAiDQogICAgICAgZD0ibSAxMS42MjY4MzYsNy40MzMxMjIgYyAwLjAwNjYsMC4wMzg1NiAwLjAxMjM3LDAuMDc3MTIgMC4wMTIzNywwLjExNjgzNiAwLDAuNDIxMDU1IC0wLjM0MTMxOSwwLjc2MTUzMSAtMC43NjIwOTMsMC43NjE1MzEgLTAuNDE5OTAzLDAgLTAuNzYxNTMxLC0wLjM0MDQ3NiAtMC43NjE1MzEsLTAuNzYxNTMxIDAsLTAuMzE0MjgxIDAuMTkwODEyLC0wLjU4MzA4NiAwLjQ2MTY0MSwtMC43MDAyMzIgLTAuMTg4Nzg4LC0wLjA0ODM0IC0wLjM4Njc5NSwtMC4wNzcxMiAtMC41OTE0MzQsLTAuMDc3MTIgLTEuMzExNTA4LDAgLTIuMzc0OTUzLDEuMDYzNzI2IC0yLjM3NDk1MywyLjM3NTgyNCAwLDEuMzExNTA4IDEuMDYzNDQ1LDIuMzc1ODI0IDIuMzc0OTUzLDIuMzc1ODI0IDEuMzEzMjUxLDAgMi4zNzYxMDUsLTEuMDY0MzE2IDIuMzc2MTA1LC0yLjM3NTgyNCAyLjgxZS00LC0wLjY3NTE5IC0wLjI4MjkxNCwtMS4yODI3MjggLTAuNzM1MDU1LC0xLjcxNTMzNSB6IiAvPjxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzY4M2QwMDtmaWxsLW9wYWNpdHk6MSINCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgIGlkPSJwYXRoMTIiDQogICAgICAgZD0ibSAxMi43NDc3ODYsNS45NzY4MTIgMC43NDk5MjMsLTEuNTMxOTE1IDAuNzc1NzgsMC4zNzk3NjggLTAuNzQ5OTIzLDEuNTMxOTE0IC0wLjc3NTc4LC0wLjM3OTc2NyB6IiAvPjxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzY4M2QwMDtmaWxsLW9wYWNpdHk6MSINCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgIGlkPSJwYXRoMTQiDQogICAgICAgZD0iTSA2LjM3OTQ1NTQsNi4zMjg5NzkgNS43MTE3NzA0LDQuODg3MTQ0IDYuNDk1MjUxOSw0LjUyNDMyNCA3LjE2MjkzNyw1Ljk2NjE2IDYuMzc5NDU1NCw2LjMyODk3OSBaIiAvPjxwYXRoDQogICAgICAgc3R5bGU9ImZpbGw6IzY4M2QwMDtmaWxsLW9wYWNpdHk6MSINCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgIGlkPSJwYXRoMTYiDQogICAgICAgZD0iTSA5LjI5NDk3LDUuNjcxMjE2IDkuMzE4ODYsMy42Mjk3NCAxMC4xODIxOSwzLjYzOTgzIDEwLjE1ODMsNS42ODEzMDYgOS4yOTQ5Nyw1LjY3MTIxNiBaIiAvPjxnDQogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTAuOTk5OTgyNDYsMC4wMDU5MjMzOSwtMC4wMDU5MjMzOSwtMC45OTk5ODI0NiwyOC4xMzI3MjMsMjAuMjczMDc1KSINCiAgICAgICBpZD0iZzQ1MjYiPjxwYXRoDQogICAgICAgICBkPSJtIDIxLjE2MjAzLDguMDEyNjYyNSAwLjc0OTkyMywtMS41MzE5MTUgMC43NzU3OCwwLjM3OTc2OCAtMC43NDk5MjMsMS41MzE5MTQgLTAuNzc1NzgsLTAuMzc5NzY3IHoiDQogICAgICAgICBpZD0icGF0aDEyLTUiDQogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgICAgc3R5bGU9ImZpbGw6IzY4M2QwMDtmaWxsLW9wYWNpdHk6MSIgLz48cGF0aA0KICAgICAgICAgZD0ibSAxNC43OTM2OTksOC4zNjQ4Mjk1IC0wLjY2NzY4NSwtMS40NDE4MzUgMC43ODM0ODIsLTAuMzYyODIgMC42Njc2ODUsMS40NDE4MzYgLTAuNzgzNDgyLDAuMzYyODE5IHoiDQogICAgICAgICBpZD0icGF0aDE0LTEiDQogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIg0KICAgICAgICAgc3R5bGU9ImZpbGw6IzY4M2QwMDtmaWxsLW9wYWNpdHk6MSIgLz48cGF0aA0KICAgICAgICAgZD0ibSAxNy43MDkyMTQsNy43MDcwNjY1IDAuMDIzODksLTIuMDQxNDc2IDAuODYzMzMsMC4wMTAwOSAtMC4wMjM4OSwyLjA0MTQ3NiAtMC44NjMzMywtMC4wMTAwOSB6Ig0KICAgICAgICAgaWQ9InBhdGgxNi05Ig0KICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCINCiAgICAgICAgIHN0eWxlPSJmaWxsOiM2ODNkMDA7ZmlsbC1vcGFjaXR5OjEiIC8+PC9nPjwvZz48L3N2Zz4='
			});
		},
	}
}